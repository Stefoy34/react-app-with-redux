# .github/workflows/ci.yml

name: Continuous Integration

on:
  pull_request:
    # Sesuaikan 'master' dengan nama branch utama Anda (bisa 'main')
    branches: [ "master" ]

jobs:
  automation-test-job:
    runs-on: ubuntu-latest

    steps:
      # 1. Mengambil kode Anda (dari contoh Dicoding)
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Menyiapkan Node.js (diadaptasi dari contoh Dicoding)
      - name: Use Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 3. (PENTING) Menginstal library sistem yang hilang
      # Ini akan memperbaiki 'TypeError' (jsdom/canvas) DAN error Cypress
      - name: Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential libcairo2-dev libpango1.0-dev libjpeg-dev libgif-dev librsvg2-dev \
            libgtk2.0-0 libgtk-3-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2 libxtst6 xauth xvfb

      # 4. npm install dan test (dari contoh Dicoding)
      - name: npm install and test
        run: |
          npm install
          npm run ci:test